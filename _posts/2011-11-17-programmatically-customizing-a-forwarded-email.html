---
layout: post
title: ! 'Code: Programmatically Customizing a Forwarded Email'
categories:
- Programming
tags: []
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  dsq_thread_id: '474669992'
  _wp_jd_clig: ''
  _jd_twitter: ''
  _jd_tweet_this: ''
  _wp_jd_bitly: ''
  _wp_jd_wp: ''
  _wp_jd_yourls: ''
  _wp_jd_url: ''
  _wp_jd_target: ''
  _jd_wp_twitter: ''
  _jd_post_meta_fixed: 'true'
---
The other day, the project manager for my team (<a href="http://brianmcmullin.com/">Brian McMullin</a>) came to me with a simple request: he wanted to change the text of the call-to-action button in one of our daily emails. His research suggested that <strong>the people who were receiving that daily email were actually forwarding it</strong> on to other people in their organization, so Brian wanted to target them a bit better.

<strong>But what if we could target them both a bit better?</strong> Well today, you can.

<h3>The code</h3>

I like it when people get straight to the point, so here's the code. If you want an explanation of how I got it and why it works, please continue reading :]

<pre>
&lt;p class="cta1"&gt;
    This will only appear when reading an original version.
&lt;/p&gt;
&lt;p class="cta2" style="display: none"&gt;
    This will only appear when reading a forwarded version.
&lt;/p&gt;

&lt;style type="text/css"&gt;
    blockquote .cta1, .WordSection1 .cta1 {
        display: none !important;
    }

    blockquote .cta2, .WordSection1 .cta2 {
        display: inline-block !important;
    }
&lt;/style&gt;
</pre>

<h3>My impromptu research</h3>
I noticed that many of the forwarded messages I received in the past displayed the original sender's message, but in a slightly different format, usually indented. With that in mind, I emailed the entire development team at HubSpot and asked everyone to forward the email back to me, along with the name of their email client. I even wrangled some sales people into doing it so I could get a good representation from people using Microsoft Outlook.

It turns out that all email services take your original message and conveniently wrap it in a div (with a class) or a blockquote, meaning <strong>you can use that as a CSS selector</strong>.

It's so stupidly simple.

<h3>Show me an example</h3>
Original version of the email:

<img src="http://jonathan-kim.com/wp/wp-content/uploads/2011/11/original-15-44-57-532.png" alt="" title="Original" width="710" height="218" class="alignnone size-full wp-image-132" />

Forwarded version:
<img src="http://jonathan-kim.com/wp/wp-content/uploads/2011/11/forwarded.png" alt="" title="Forwarded" width="705" height="189" class="alignnone size-full wp-image-131" />

<h3>How to use it</h3>

Stick that piece of code in the body of your email (putting it in the head section makes it more susceptible to being parsed out). Then apply the class "cta1" to the element you want to show in the original, and cta2 to the element you want to show in the forwarded version. Make sure to also add the CSS declaration "display:none" to the elements that have the cta2 class on them, so they're hidden by default.

When your recipient is reading a forwarded version of the email, the code snippet will take effect by hiding the original and showing what was previously hidden.

<h3>Some caveats</h3>

Believe it or not, Gmail is doing ungodly things to make email design miserable. Campaign Monitor has a really awesome chart showing <a href="http://www.campaignmonitor.com/css/">email compatibility across clients</a>, and Gmail and Android are the worst, perhaps even worse than Blackberry. They don't support external css blocks, which makes this technique completely ineffective.

<strong>What about just hiding the second call-to-action so it's not awkward?</strong>
They've thought of that too. Gmail scrubs your email for anything, and I mean ANYTHING, that can hide an element on a page. Here's a short list of the hacks I've tried:

<ul>
	<li>CSS "display: none"</li>
	<li>CSS "visibility: hidden"</li>
	<li>CSS "text-indent: -9999px" or "text-indent: 9999px"</li>
	<li>CSS "margin-top: -9999px" or "margin-bottom: 9999px"</li>
	<li>CSS "position: absolute" + "top: -9999px"</li>
	<li>HTML5 "hidden" attribute</li>
</ul>

If you find a way to make it work in Gmail, please share. It's true that you can do stuff using server-side requests and header parsing to return different images. If you want to go that route, good luck :P

<h3>When to use (or not use) this technique</h3>

If your email list is mostly composedly of Gmail users, you probably shouldn't use this technique. You also probably shouldn't use it to spam people.

At HubSpot, over 50% of our email recipients view these emails on some version of Outlook. About 20% view it on Apple Mail, and about 15% view it on an iPhone. Only 6% of our customers actually use Gmail to view our emails. Just the same, it's a good idea to make sure the email still looks natural with both call-to-actions displayed simultaneously.

<h3>Further reading</h3>

Hopefully this simple little technique sets your mind ablaze with other ideas to provide value with simple hacks. If you're interested in pushing the envelope in the email sector, the <a href="http://litmus.com/email-analytics">guys at Litmus are doing some pretty amazing stuff</a>. Here's some discussion behind the secret sauce that puts them ahead of the pack in terms of email analytics:

<ul>
	<li><a href="http://stackoverflow.com/questions/3224436/how-does-litmus-track-their-email-analytics">http://stackoverflow.com/questions/3224436/how-does-litmus-track-their-email-analytics</a></li>
	<li><a href="http://stackoverflow.com/questions/2958926/track-mass-email-campaigns">http://stackoverflow.com/questions/2958926/track-mass-email-campaigns</a></li>
</ul>

They're my source for the email analytics used in this article. I highly recommend signing up with them and getting solid data on your email demographics and baseline click-through rates before attempting any of the above.
